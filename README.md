# After-boot-testing

## 简介

这是一个系统启动后进行访存与多核通讯验证的测试用例，用于 Chipyard 所生成的 SoC。

## 快速开始

进入 Chipyard 的根目录，配置好环境：

```bash
source ./env.sh
```

> 需要使用到 `riscv64-unknown-linux-gnu-gcc` 来在本地交叉编译测试用例，然后再将编译好的可执行测试用例放到 SoC 所读取的 SD 卡上。

克隆本项目，并进入项目目录：

```bash
git clone https://www.github.com/ljchen98/after-boot-testing.git
cd after-boot-testing
```

编译测试用例：

```
make
```

然后将生成的 `afterBootTest` 可执行文件放入 SD 卡中，系统启动后运行即可：

```bash
chmod +x afterBootTest
./afterBootTest 128
```

其中，第一个参数为以 Byte 为单位的访存大小。

## 工作原理介绍

### 基本原理

依据操作系统给测试用例所使用的线程分配的运行核心，完成单核和多核的访存与通讯测试。其中，多线程使用了 OpenMP 进行测试用例编写。

### 测试用例测试范围

目前，测试用例会依据操作系统给其线程分配的运行核心，进行如下测试任务：

- 单线程访存：内存范围内地址的写与读 -- 背靠背写读；
- 单线程访存：内存范围内地址的写与读 -- 非背靠背写读；
- 单线程访存：分别单独使用每个数据位写与读 -- 背靠背写读；
- 单线程访存：分别单独使用每个数据位写与读 -- 非背靠背写读；
- 多线程访存：内存范围内地址的写与读 -- 背靠背写读；
- 多线程访存：内存范围内地址的写与读 -- 非背靠背写读。

